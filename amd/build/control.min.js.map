{"version":3,"sources":["../src/control.js"],"names":["define","$","Ajax","Log","Controls","username","self","prototype","main","getSynAssign","setupEvents","init_tree","on","getConnectAssign","click","trigger","assignHideCarretHandler","getConnectQuizz","quizzHideCarretHandler","removeAttr","call","methodname","args","done","response","debug","htmlResult","html","attr","replaceWith","fail","reason","error","off","toggle","render_feedback_file_tree","children","each","find","i","treecol","first","htmlid","treeElement","Y","one","use","tree","YUI2","widget","TreeView","subscribe","node","getContentEl","simulate","setNodesProperty","render","init","element","document","querySelector","getAttribute","control"],"mappings":"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","sourcesContent":["\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n\n/**\n * @package   block_assignmentsquizzes_report\n * @copyright 2021 Veronica Bermegui\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'core/log'], function ($, Ajax, Log) {\n    'use strict';\n\n    function init() {\n        const element = document.querySelector('.connect-assign-quizz');\n        const username = element.getAttribute('data-username');\n\n        var control = new Controls(username);\n        control.main();\n    }\n\n    /**\n    * Controls a single block_assignmentsquizzes_report block instance contents.\n    *\n    * @constructor\n    */\n    function Controls(username) {\n        let self = this;\n        self.username = username;\n    }\n\n    /**\n     * Run the controller.\n     *\n     */\n    Controls.prototype.main = function () {\n        let self = this;\n        self.getSynAssign();\n        self.setupEvents();\n        self.init_tree('feedback_files_tree');\n\n    };\n\n\n    Controls.prototype.setupEvents = function () {\n        let self = this;\n\n        $('.connect-assignment').on('custom.getConnectAssign', function () {\n            self.getConnectAssign();\n        });\n\n        $('.connect-assignment').click(function () {\n            $(this).trigger('custom.getConnectAssign');\n        });\n\n        $('.connect-assignment').on('custom.renderFeedbackTree', function () {\n            self.init_tree();\n        });\n\n        $('.connect-assignment').on('custom.assignHideCarretHandler', function () {\n            self.assignHideCarretHandler();\n        });\n\n        $('.connect-quizz').on('custom.getConnectQuizz', function () {\n            self.getConnectQuizz();\n        });\n\n        $('.connect-quizz').click(function () {\n            $(this).trigger(\"custom.getConnectQuizz\");\n        });\n\n        $('.connect-quizz').on('custom.quizzHideCarretHandler', function () {\n            self.quizzHideCarretHandler();\n        });\n\n    };\n\n    Controls.prototype.getSynAssign = function () {\n        let self = this;\n        const username = self.username;\n\n        // Add spinner.\n        $('#syn-assignment-table').removeAttr('hidden');\n\n        Ajax.call([{\n            methodname: 'block_assignment_quizz_report_get_syn_assign_context',\n            args: {\n                username: username\n            },\n\n            done: function (response) {\n                Log.debug(response);\n                 const htmlResult = response.html;\n                $('#syn-assignment-table').attr('hidden', true);\n                $('[data-region=\"syn-assignment\"]').replaceWith(htmlResult);\n               \n            },\n\n            fail: function (reason) {\n                Log.error('block_assignmentsquizzes_report: Unable to get context.');\n                Log.debug(reason);\n                $('[data-region=\"syn-assignment\"]').replaceWith('<p class=\"alert alert-danger\">Data not available. Please try later</p>');\n            }\n        }]);\n\n        $('.syn-assignment').off('custom.getSynAssign'); // Remove listener.\n    \n    }\n\n    Controls.prototype.getConnectAssign = function () {\n        let self = this;\n        const username = self.username;\n\n        // Add spinner.\n        $('#connect-assignment-table').removeAttr('hidden');\n        $('#connectassignment-show').toggle(); // Carret down.\n        $('#connectassignment-hide').toggle(); // Carret right\n\n        Ajax.call([{\n            methodname: 'block_assignment_quizz_report_get_connect_assign_context',\n            args: {\n                username: username\n            },\n\n            done: function (response) {\n                const htmlResult = response.html;\n                $('#connect-assignment-table').attr('hidden', true);\n                $('[data-region=\"connect-assignment\"]').replaceWith(htmlResult);\n                self.render_feedback_file_tree();\n            },\n\n            fail: function (reason) {\n                Log.error('block_assignmentsquizzes_report: Unable to get context.');\n                Log.debug(reason);\n                $('[data-region=\"connect-assignment\"]').replaceWith('<p class=\"alert alert-danger\">Data not available. Please try later</p>');\n            }\n        }]);\n\n        $('.connect-assignment').off('custom.getConnectAssign'); // Remove listener.\n        $('.connect-assignment').on('click', function () {\n            $(this).trigger(\"custom.assignHideCarretHandler\");\n        });\n\n\n    };\n\n\n    Controls.prototype.getConnectQuizz = function () {\n        let self = this;\n        const username = self.username;\n\n        // Add spinner.\n        $('#connect-quizz-table').removeAttr('hidden');\n        $('#connectquizz-show').toggle(); // Carret down.\n        $('#connectquizz-hide').toggle(); // Carret right\n\n        Ajax.call([{\n            methodname: 'block_assignment_quizz_report_get_connect_quizz_context',\n            args: {\n                username: username\n            },\n\n            done: function (response) {\n                const htmlResult = response.html;\n                $('#connect-quizz-table').attr('hidden', true);\n                $('[data-region=\"connect-quizz\"]').replaceWith(htmlResult);\n            },\n\n            fail: function (reason) {\n                Log.error('block_assignmentsquizzes_report: Unable to get context.');\n                Log.debug(reason);\n                $('[data-region=\"connect-quizz\"]').replaceWith('<p class=\"alert alert-danger\">Data not available. Please try later</p>');\n            }\n        }]);\n\n        $('.connect-quizz').off('custom.getConnectQuizz'); // Remove listener.\n\n        $('.connect-quizz').on('click', function () {\n            $(this).trigger(\"custom.quizzHideCarretHandler\");\n        });\n\n    };\n\n    Controls.prototype.assignHideCarretHandler = function () {\n\n        $('#connectassignment-hide').toggle(); // Carret right. (Table is hidden)\n        $('#connectassignment-show').toggle(); // Carret down. (Table is displayed)\n\n    }\n\n    Controls.prototype.quizzHideCarretHandler = function () {\n\n        $('#connectquizz-hide').toggle(); // Carret right. (Table is hidden)\n        $('#connectquizz-show').toggle(); // Carret down. (Table is displayed)\n    }\n\n    Controls.prototype.render_feedback_file_tree = function () {\n        var self = this;\n\n        $('#connectassignrep').children().each(function (e) {\n            $(this).find('td:last').children().each(function (i) {\n                let treecol = ($(this).first()[i]);\n                let htmlid = $(treecol).attr('id');\n\n                self.init_tree(htmlid);\n            });\n\n        });\n    }\n\n    Controls.prototype.init_tree = function (htmlid) {\n        var treeElement = Y.one('#' + htmlid);\n       \n        if (treeElement) {\n            Y.use('yui2-treeview', 'node-event-simulate', function (Y) {\n                var tree = new Y.YUI2.widget.TreeView(htmlid);\n                tree.subscribe(\"clickEvent\", function (node, event) {\n                    // We want normal clicking which redirects to url.\n                    return false;\n                });\n\n                tree.subscribe(\"enterKeyPressed\", function (node) {\n                    // We want keyboard activation to trigger a click on the first link.\n                    Y.one(node.getContentEl()).one('a').simulate('click');\n                    return false;\n                });\n                \n                tree.setNodesProperty('className', 'feedbackfilestv', false);\n                tree.render();\n            });\n        }\n\n    }\n\n\n    return { init: init }\n});\n"],"file":"control.min.js"}