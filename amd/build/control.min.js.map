{"version":3,"sources":["../src/control.js"],"names":["define","$","Ajax","Log","Controls","username","self","prototype","main","setupEvents","init_tree","on","getConnectAssign","click","trigger","assignHideCarretHandler","getConnectQuizz","quizzHideCarretHandler","removeAttr","toggle","call","methodname","args","done","response","htmlResult","html","region","attr","replaceWith","render_feedback_file_tree","fail","reason","error","debug","off","children","each","find","i","treecol","first","htmlid","treeElement","Y","one","use","tree","YUI2","widget","TreeView","subscribe","node","getContentEl","simulate","setNodesProperty","console","log","render","init","element","document","querySelector","getAttribute","control"],"mappings":"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","sourcesContent":["\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n\n/**\n * @package   block_assignmentsquizzes_report\n * @copyright 2021 Veronica Bermegui\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'core/log'], function ($, Ajax, Log) {\n    'use strict';\n\n    function init() {\n        const element = document.querySelector('.connect-assign-quizz');\n        const username = element.getAttribute('data-username');\n\n        var control = new Controls(username);\n        control.main();\n    }\n\n    /**\n    * Controls a single block_assignmentsquizzes_report block instance contents.\n    *\n    * @constructor\n    */\n    function Controls(username) {\n        let self = this;\n        self.username = username;\n    }\n\n    /**\n     * Run the controller.\n     *\n     */\n    Controls.prototype.main = function () {\n        let self = this;\n        self.setupEvents();\n        self.init_tree('feedback_files_tree');\n\n    };\n\n\n    Controls.prototype.setupEvents = function () {\n        let self = this;\n\n        $('.connect-assignment').on('custom.getConnectAssign', function () {\n            self.getConnectAssign();\n        });\n\n        $('.connect-assignment').click(function () {\n            $(this).trigger('custom.getConnectAssign');\n        });\n\n        $('.connect-assignment').on('custom.renderFeedbackTree', function () {\n            self.init_tree();\n        });\n\n        $('.connect-assignment').on('custom.assignHideCarretHandler', function () {\n            self.assignHideCarretHandler();\n        });\n\n        $('.connect-quizz').on('custom.getConnectQuizz', function () {\n            self.getConnectQuizz();\n        });\n\n        $('.connect-quizz').click(function () {\n            $(this).trigger(\"custom.getConnectQuizz\");\n        });\n\n        $('.connect-quizz').on('custom.quizzHideCarretHandler', function () {\n            self.quizzHideCarretHandler();\n        });\n\n    };\n\n    Controls.prototype.getConnectAssign = function () {\n        let self = this;\n        const username = self.username;\n\n        // Add spinner.\n        $('#connect-assignment-table').removeAttr('hidden');\n        $('#connectassignment-show').toggle(); // Carret down.\n        $('#connectassignment-hide').toggle(); // Carret right\n\n        Ajax.call([{\n            methodname: 'block_assignment_quizz_report_get_connect_assign_context',\n            args: {\n                username: username\n            },\n\n            done: function (response) {\n                const htmlResult = response.html;\n                const region = $('[data-region=\"connect-assignment\"]');\n\n                $('#connect-assignment-table').attr('hidden', true);\n                region.replaceWith(htmlResult);\n                self.render_feedback_file_tree();\n            },\n\n            fail: function (reason) {\n                Log.error('block_assignmentsquizzes_report: Unable to get context.');\n                Log.debug(reason);\n                region.replaceWith('<p class=\"alert alert-danger\">Data not available. Please try later</p>');\n            }\n        }]);\n\n        $('.connect-assignment').off('custom.getConnectAssign'); // Remove listener.\n        $('.connect-assignment').on('click', function () {\n            $(this).trigger(\"custom.assignHideCarretHandler\");\n        });\n\n\n    };\n\n\n    Controls.prototype.getConnectQuizz = function () {\n        let self = this;\n        const username = self.username;\n\n        // Add spinner.\n        $('#connect-quizz-table').removeAttr('hidden');\n        $('#connectquizz-show').toggle(); // Carret down.\n        $('#connectquizz-hide').toggle(); // Carret right\n\n        Ajax.call([{\n            methodname: 'block_assignment_quizz_report_get_connect_quizz_context',\n            args: {\n                username: username\n            },\n\n            done: function (response) {\n                const htmlResult = response.html;\n                const region = $('[data-region=\"connect-quizz\"]');\n\n                $('#connect-quizz-table').attr('hidden', true);\n                region.replaceWith(htmlResult);\n            },\n\n            fail: function (reason) {\n                Log.error('block_assignmentsquizzes_report: Unable to get context.');\n                Log.debug(reason);\n                region.replaceWith('<p class=\"alert alert-danger\">Data not available. Please try later</p>');\n            }\n        }]);\n\n        $('.connect-quizz').off('custom.getConnectQuizz'); // Remove listener.\n\n        $('.connect-quizz').on('click', function () {\n            $(this).trigger(\"custom.quizzHideCarretHandler\");\n        });\n\n    };\n\n    Controls.prototype.assignHideCarretHandler = function () {\n\n        $('#connectassignment-hide').toggle(); // Carret right. (Table is hidden)\n        $('#connectassignment-show').toggle(); // Carret down. (Table is displayed)\n\n    }\n\n    Controls.prototype.quizzHideCarretHandler = function () {\n\n        $('#connectquizz-hide').toggle(); // Carret right. (Table is hidden)\n        $('#connectquizz-show').toggle(); // Carret down. (Table is displayed)\n    }\n\n    Controls.prototype.render_feedback_file_tree = function () {\n        var self = this;\n\n        $('#connectassignrep').children().each(function (e) {\n            $(this).find('td:last').children().each(function (i) {\n                let treecol = ($(this).first()[i]);\n                let htmlid = $(treecol).attr('id');\n\n                self.init_tree(htmlid);\n            });\n\n        });\n    }\n\n    Controls.prototype.init_tree = function (htmlid) {\n        var treeElement = Y.one('#' + htmlid);\n       \n        if (treeElement) {\n            Y.use('yui2-treeview', 'node-event-simulate', function (Y) {\n                var tree = new Y.YUI2.widget.TreeView(htmlid);\n                tree.subscribe(\"clickEvent\", function (node, event) {\n                    // We want normal clicking which redirects to url.\n                    return false;\n                });\n\n                tree.subscribe(\"enterKeyPressed\", function (node) {\n                    // We want keyboard activation to trigger a click on the first link.\n                    Y.one(node.getContentEl()).one('a').simulate('click');\n                    return false;\n                });\n                \n                tree.setNodesProperty('className', 'feedbackfilestv', false);\n                \n                console.log(tree);\n                // tree.expandAll();\n                tree.render();\n            });\n        }\n\n    }\n\n\n    return { init: init }\n});\n"],"file":"control.min.js"}